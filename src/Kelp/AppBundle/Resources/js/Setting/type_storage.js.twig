var $modal = $('#modal_type_storage');
var $formModal = $('#form_modal_type_storage');
var $modalTitle = $('#modal_type_storage h4');

$body.on('click', '#show_modal_type_storage', function () {

    $('div').removeClass('has-error')
    $('span').remove('.help-block');


    $modal.data('url', "{{ path('kelp_add_setting_type_storage', {'event': 'add'}) }}");
    $modalTitle.html('Add Type Storage');
    $modal.modal('show');
});

$body.on('click', '.btn-edit', function () {

    var idTypeStorage = $(this).data('id');
    var urlFind = "{{ path('kelp_find_setting_type_storage', {'event' : 'find', 'id': '0' }) }}";
    urlFind = urlFind.replace('0', idTypeStorage);
    var urlEdit = $(this).data('url');

    $.ajax({
        type: "GET",
        url: urlFind,
    }).done(function (data) {


        $('#type_storage_label').val(data.label);
        $('#type_storage_comment').val(data.comment);
        $modalTitle.html('Edit Type Storage');
        $modal.data('url', urlEdit);
        $modal.modal('show');
    }).fail(function (jqXHR) {
        if (jqXHR.status === 400) {
            var response = jqXHR.responseJSON;
            if (response.errorMessage != undefined) {
                addError('type_storage_', response.errorMessage);
            }
        }
    });

    $modalTitle.html('Edit Type Storage');
    $modal.modal('show');
});

$body.on('click', '#submit_modal_type_storage', function () {

    var url = $modal.data('url');
    var data = $formModal.serialize();

    $('div').removeClass('has-error')
    $('span').remove('.help-block');

    $.ajax({
        type: "POST",
        url: url,
        data: data
    }).done(function () {
            window.location  = "{{ path('kelp_setting_type_storage') }}";
    }).fail(function (jqXHR) {
        if (jqXHR.status === 400) {
            var response = jqXHR.responseJSON;
            if (response.errorMessage != undefined) {
                addError('type_storage_', response.errorMessage);
            }
        }
    });
});

function addError(formName, listError) {

    for (var error in listError)
    {
        $('#' + formName + error).parents('.form-group').addClass('has-error');

        $('#' + formName + error).parent().append(''+

                '<span class="help-block">' +
                    '<ul class="list-unstyled">'+
                        '<li>'+
                            '<span class="fa fa-exclamation-triangle"></span> '+
                            listError[error] +
                        '</li>'+
                    '</ul>' +
                '</span>');
    }
}
